#!/bin/bash

set -o errexit

cd `dirname $0`
cd ..

# refresh dependencies in pom.xml
clojure -Spom
# update version number from deps.edn etc...
clojure -X:pom-update ':mvn/version' "\"0.2.$GITHUB_RUN_NUMBER\"" ':scm/tag' "\"$GITHUB_RUN_NUMBER\""

# create jar
clojure -X:jar

# deploy
clojure -X:deploy '[:repository "clojars" :password]' "\"$CLOJARS_TOKEN\""
